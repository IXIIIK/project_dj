<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if card %}Редактировать{% else %}Добавить{% endif %} карточку</title>
  <link rel="stylesheet" href="/static/style.css?v=17">
  <style>
    .wrap{max-width:640px;margin:24px auto;padding:0 18px}
    form{display:flex;flex-direction:column;gap:16px;background:#fff;padding:24px;border-radius:12px;box-shadow:var(--shadow)}
    label{font-weight:600;margin-bottom:4px;display:block}
    input,textarea,select{padding:8px;border:1px solid #ccc;border-radius:6px;width:100%}
    .btn{padding:10px 16px;border-radius:6px;background:#5A7BFF;color:#fff;text-decoration:none;border:none;cursor:pointer}
    .field{display:flex;flex-direction:column}
    .checkbox-inline{display:flex;align-items:center;gap:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="crumbs" style="margin:0 0 12px">
      <a href="{% url 'showcases_admin' %}">← К витринам</a> ·
      {% if showcase %}<a href="{% url 'cards_admin' showcase.id %}">Карточки — {{ showcase.name }}</a>{% endif %}
    </div>

    <h2>{% if card %}Редактировать{% else %}Добавить{% endif %} карточку</h2>

    <!-- ВАЖНО: открываем форму, csrf и скрытое поле витрины -->
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      {{ form.showcase }}

      <div class="field">
        <label for="id_title">Название</label>
        {{ form.title }}
      </div>

      <div class="field">
        <label for="id_price">Цена</label>
        {{ form.price }}
      </div>

      <div class="field">
        <label for="id_rate_line">Ставка</label>
        {{ form.rate_line }}
      </div>

      <div class="field">
        <label for="id_age_line">Возраст</label>
        {{ form.age_line }}
      </div>

      <div class="field">
        <label for="id_btn_text">Текст кнопки</label>
        {{ form.btn_text }}
      </div>

      <div class="field">
        <label for="id_btn_url">Ссылка кнопки</label>
        {{ form.btn_url }}
      </div>

      <div class="field">
        <label for="id_fine_print">Мелкий текст</label>
        {{ form.fine_print }}
      </div>

      <div class="field">
        <label for="id_logo">Логотип</label>
        {{ form.logo }}
        {% if card and card.logo %}
          <p>Текущий: <img src="{{ card.logo.url }}" alt="" style="height:40px"></p>
        {% endif %}
      </div>

      <div class="field">
        <label for="id_order_index">Позиция</label>
        {{ form.order_index }}
      </div>

      <div class="field checkbox-inline">
        {{ form.active }} <label for="id_active">Активна</label>
      </div>

      <button type="submit" class="btn">Сохранить</button>
    </form>

    <p><a href="{% url 'cards_admin' showcase.id %}">← Назад к списку карточек</a></p>
  </div>
</body>
</html>
